<?xml version="1.0" encoding="UTF-8"?>

<!--L
   Copyright Leidos
   Copyright Leidos Biomedical

   Distributed under the OSI-approved BSD 3-Clause License.
   See http://ncip.github.com/cananolab/LICENSE.txt for details.
L-->

<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">
<beans default-lazy-init="false" default-autowire="no">

	<bean name="ApplicationServiceImpl" class="gov.nih.nci.cananolab.system.applicationservice.impl.CaNanoLabApplicationServiceImpl">
		<constructor-arg ref="ClassCache" index="0"/>
	</bean>

	<!-- Bean Definitions -->
	<bean name="ClassCache" class="gov.nih.nci.cananolab.system.util.ClassCache">
		<property name="daoList">
			<list>
				<!--  Add any DAO's here -->
				<ref bean="ORMDAO" />
			</list>
		</property>
	</bean>


	<bean name="WebSystemProperties" class="java.util.Properties">
		<constructor-arg>
			<props>
				<prop key="resultOutputFormatter">resultOutputFormatter.xsl</prop>
				<prop key="rowCounter">200</prop>
				<prop key="securityEnabled">false</prop>
			</props>
		</constructor-arg>
	</bean>


	<bean name="ORMDAO" class="gov.nih.nci.cananolab.system.dao.orm.CaNanoLabORMDAOImpl">
		<property name="caseSensitive" value="false" />
		<property name="resultCountPerQuery" value="10000" />
				<property name="securityHelper">
					<ref bean="SecurityInitializationHelper" />
				</property>
		<property name="sessionFactory" ref="SessionFactory" />
		<property name="config">
			<bean factory-bean="HibernateConfigHolder" factory-method="getConfiguration" />
		</property>
	</bean>


	<bean name="HibernateConfigHolder" class="gov.nih.nci.cananolab.system.dao.orm.HibernateConfigurationHolder" />

	<bean name="SessionFactory" class="org.springframework.orm.hibernate5.LocalSessionFactoryBean">
		<!--<propertyname="dataSource"ref="myDataSource"/>-->
		<!--<propertyname="mappingResources">-->
		<!--<list>-->
		<!--<value>product.hbm.xml</value>-->
		<!--</list>-->
		<!--</property>-->
		<property name="hibernateProperties">
			<value>
				hibernate.dialect=org.hibernate.dialect.MySQLDialect
			</value>
		</property>
	</bean>

<!--	<bean name="SessionFactory" class="gov.nih.nci.cananolab.system.dao.orm.SessionFactoryBean">-->
<!--		<property name="configLocation" value="hibernate.cfg.xml" />-->
<!--		<property name="configHolder" ref="HibernateConfigHolder" />-->
<!--		<property name="securityHelper" ref="SecurityInitializationHelper"/>-->
<!--		<property name="entityInterceptor">-->
<!--			<bean class="gov.nih.nci.cananolab.security.GenericSecurityInterceptor">-->
<!--				<constructor-arg>-->
<!--					<list>-->
<!--						<bean class="org.hibernate.EmptyInterceptor"/>-->
<!--						&lt;!&ndash;-->
<!--						<bean class="gov.nih.nci.security.authorization.attributeLevel.AttributeSecuritySessionInterceptor">-->
<!--							<constructor-arg value="false"/>-->
<!--						</bean>-->
<!--						&ndash;&gt;-->
<!--						&lt;!&ndash;<bean class="gov.nih.nci.logging.api.logger.hibernate.ObjectStateInterceptor"/>&ndash;&gt;-->
<!--					</list>		-->
<!--				</constructor-arg>-->
<!--			</bean>-->
<!--		</property>-->
<!--&lt;!&ndash;		<property name="eventListeners">&ndash;&gt;-->
<!--&lt;!&ndash;			<map>&ndash;&gt;-->
<!--&lt;!&ndash;				&lt;!&ndash;&ndash;&gt;-->
<!--&lt;!&ndash;				<entry key="pre-insert">&ndash;&gt;-->
<!--&lt;!&ndash;					<bean class="org.hibernate.validator.event.ValidateEventListener" />&ndash;&gt;-->
<!--&lt;!&ndash;				</entry>&ndash;&gt;-->
<!--&lt;!&ndash;				<entry key="pre-update">&ndash;&gt;-->
<!--&lt;!&ndash;					<bean class="org.hibernate.validator.event.ValidateEventListener" />&ndash;&gt;-->
<!--&lt;!&ndash;				</entry>&ndash;&gt;-->
<!--&lt;!&ndash;				&ndash;&gt;&ndash;&gt;-->
<!--&lt;!&ndash;			</map>&ndash;&gt;-->
<!--&lt;!&ndash;		</property>&ndash;&gt;-->
<!--	</bean>-->

	<bean name="SecurityInitializationHelper" class="gov.nih.nci.cananolab.security.helper.SecurityInitializationHelper">
		<property name="securityEnabled" value="false"/>
		<property name="instanceLevelSecurityEnabled" value="false"/>
		<property name="attributeLevelSecurityEnabled" value="false"/>
		<!--
		<property name="authorizationManager">
			<bean factory-bean="userDetailsService" factory-method="authorizationManagerInstance" />
		</property>
		-->
	</bean>

	<bean id="HibernateTransactionManager" class="org.springframework.orm.hibernate5.HibernateTransactionManager">
		<property name="sessionFactory" ref="SessionFactory" />
	</bean>

	<bean id="TxInterceptor" class="org.springframework.transaction.interceptor.TransactionInterceptor">
		<property name="transactionManager">
			<ref bean="HibernateTransactionManager" />
		</property>
		<property name="transactionAttributes">
			<props>
				<prop key="execute*">
					PROPAGATION_REQUIRED,-gov.nih.nci.cananolab.system.applicationservice.ApplicationException,-gov.nih.nci.cananolab.system.dao.DAOException
				</prop>
				<prop key="save*">
					PROPAGATION_REQUIRED,-gov.nih.nci.cananolab.system.applicationservice.ApplicationException,-gov.nih.nci.cananolab.system.dao.DAOException
				</prop>
				<prop key="delete*">
					PROPAGATION_REQUIRED,-gov.nih.nci.cananolab.system.applicationservice.ApplicationException,-gov.nih.nci.cananolab.system.dao.DAOException
				</prop>
				<prop key="*">PROPAGATION_REQUIRED,readOnly</prop>
			</props>			
		</property>
	</bean>

	<bean id="ApplicationService" class="org.springframework.aop.framework.ProxyFactoryBean">
		<property name="target" ref="ApplicationServiceImpl" />
		<property name="interfaces" value="gov.nih.nci.cananolab.system.applicationservice.CaNanoLabApplicationService" />
		<!-- <property name="interceptorNames">
			<list>
				<idref local="TxInterceptor" />
				<idref local="CLMInterceptor" />
			</list>
		</property> -->
	</bean>


	<!--<bean id="CLMInterceptor" class="gov.nih.nci.system.client.proxy.CLMProxy"/>-->
</beans>